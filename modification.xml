<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.elkarte.net/site/modification">
<!--
/**
 * @package SimplePortal ElkArte
 *
 * @author SimplePortal Team
 * @copyright 2015 SimplePortal Team
 * @license BSD 3-clause
 * @version 1.0.0 Beta 2
 *
 * This version of SimplePortal ElkArte is based on SimplePortal core 2.4
 */
-->
<modification xmlns="http://www.elkarte.net/site/modification" xmlns:elk="http://www.elkarte.net/">
	<id>[SiNaN]:SimplePortal</id>
	<version>1.0.0 Beta 2</version>

	<file name="SOURCEDIR/Load.php">
		<operation>
			<search position="replace"><![CDATA[	// Verify the id_theme... no foul play.]]></search>
			<add><![CDATA[	global $sp_standalone;

	// Maybe we have a portal specific theme?
	if (!isset($_GET['action']) && !isset($_GET['board']) && !isset($_GET['topic']) && ($modSettings['sp_portal_mode'] == 1 || !empty($sp_standalone)) && !empty($modSettings['portaltheme']))
		$id_theme = (int) $modSettings['portaltheme'];

	// Verify the id_theme... no foul play.]]></add>
		</operation>
	</file>

	<file name="SOURCEDIR/Subs.php">
		<operation error="ignore">
			<search position="replace"><![CDATA[			// For parsed content, we must recurse to avoid security problems.
			if ($tag['type'] !== 'unparsed_equals')
				$data = parse_bbc($data, !empty($tag['parsed_tags_allowed']) ? false : true, '', !empty($tag['parsed_tags_allowed']) ? $tag['parsed_tags_allowed'] : array());

			$tag['after'] = strtr($tag['after'], array('$1' => $data));]]></search>
			<add><![CDATA[			// For parsed content, we must recurse to avoid security problems.
			if ($tag['type'] !== 'unparsed_equals')
			{
				$data = parse_bbc($data, !empty($tag['parsed_tags_allowed']) ? false : true, '', !empty($tag['parsed_tags_allowed']) ? $tag['parsed_tags_allowed'] : array());

				// Unfortunately after we recurse, we must manually reset the static disabled tags to what they were
				parse_bbc('dummy');
			}

			$tag['after'] = strtr($tag['after'], array('$1' => $data));]]></add>
		</operation>
	</file>

	<file name="THEMEDIR/Theme.php">
		<operation>
			<search position="replace"><![CDATA['admin_forum', 'manage_boards']]></search>
			<add><![CDATA['admin_forum', 'manage_boards', 'sp_admin', 'sp_manage_settings', 'sp_manage_blocks', 'sp_manage_articles', 'sp_manage_pages', 'sp_manage_shoutbox']]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[cache_get_data('menu_buttons-' . implode('_', $user_info['groups']) . '-' . $user_info['language']]]></search>
			<add><![CDATA[cache_get_data('menu_buttons-' . implode('_', $user_info['groups']) . '-' . $user_info['language'] . '-' . empty($context['disable_sp'])]]></add>
		</operation>
		<operation>
			<search position="replace"><![CDATA[cache_put_data('menu_buttons-' . implode('_', $user_info['groups']) . '-' . $user_info['language']]]></search>
			<add><![CDATA[cache_put_data('menu_buttons-' . implode('_', $user_info['groups']) . '-' . $user_info['language'] . '-' . empty($context['disable_sp'])]]></add>
		</operation>
	</file>

	<file name="THEMEDIR/scripts/script.js">
		<operation>
			<search position="replace"><![CDATA['#c']]></search>
			<add><![CDATA[elk_forum_action . '#c']]></add>
		</operation>
	</file>

</modification>
